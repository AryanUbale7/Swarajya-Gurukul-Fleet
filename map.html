<!DOCTYPE html>
<html>
<head>
<title>Startup Fleet Tracking</title>

<link rel="stylesheet"
href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
#map{
height:100vh;
width:100%;
}
</style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>

// MAP
const map = L.map('map').setView([19.2952,72.8544], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
attribution:'&copy; OpenStreetMap'
}).addTo(map);


// BUS ICON
const busIcon = L.icon({
iconUrl:'https://cdn-icons-png.flaticon.com/512/3448/3448339.png',
iconSize:[40,40]
});


// SCHOOL DESTINATION
const school = [19.3033,72.8618];

L.marker(school)
.addTo(map)
.bindPopup("üè´ Destination School");


// ‚≠ê‚≠ê‚≠ê FIVE DIFFERENT START LOCATIONS
const busStarts = [

[19.2952,72.8544], // Mira Road
[19.3100,72.8500], // Bhayandar West
[19.2900,72.8700], // Kashimira
[19.3050,72.8750], // Beverly Park
[19.3150,72.8650]  // Uttan side

];


// ROUTING FUNCTION
async function getRoute(start,end){

const url =
`https://router.project-osrm.org/route/v1/driving/${start[1]},${start[0]};${end[1]},${end[0]}?overview=full&geometries=geojson`;

const res = await fetch(url);
const data = await res.json();

const coords = data.routes[0].geometry.coordinates;

return coords.map(c=>[c[1],c[0]]);
}



// ‚≠ê BUS OBJECT ARRAY
const buses = [];


// INIT EVERYTHING
async function initFleet(){

for(let i=0;i<busStarts.length;i++){

const route = await getRoute(busStarts[i],school);

// draw path
L.polyline(route,{
color:'red',
weight:4,
opacity:0.5
}).addTo(map);


// create marker
const marker = L.marker(route[0],{
icon:busIcon
}).addTo(map);


// store bus object
buses.push({
marker:marker,
route:route,
index:0
});

}

// start movement
moveFleet();
}

initFleet();


// üöÄ MOVE ALL BUSES
function moveFleet(){

setInterval(()=>{

buses.forEach(bus=>{

bus.index++;

if(bus.index >= bus.route.length){

// restart from beginning üòà
bus.index = 0;
}

const nextPoint = bus.route[bus.index];

bus.marker.setLatLng(nextPoint);

});

},900);
}

</script>

</body>
</html>
