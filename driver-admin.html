<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fleet Pro | Live Driver Monitor</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #6366f1; --bg: #f3f4f6; --text-muted: #64748b; --white: #ffffff; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; margin: 0; display: flex; background: var(--bg); color: #1e293b; }

        /* --- SIDEBAR --- */
        .sidebar { width: 280px; background: var(--white); padding: 32px 20px; height: 100vh; border-right: 1px solid #e2e8f0; position: fixed; display: flex; flex-direction: column; z-index: 1000; }
        .logo-box { font-size: 20px; font-weight: 800; color: #0f172a; margin-bottom: 40px; display: flex; align-items: center; gap: 10px; }
        .logo-icon { width: 32px; height: 32px; background: var(--primary); border-radius: 8px; display: grid; place-items: center; color: white; }
        
        .nav-group { flex: 1; }
        .nav-item { padding: 12px 16px; margin-bottom: 6px; border-radius: 12px; cursor: pointer; transition: 0.3s; font-weight: 600; color: var(--text-muted); display: flex; align-items: center; gap: 12px; text-decoration: none; }
        .nav-item:hover, .nav-item.active { background: #eef2ff; color: var(--primary); }

        /* --- MAIN --- */
        .main { margin-left: 280px; width: calc(100% - 280px); padding: 50px 60px; }
        .header { margin-bottom: 30px; }
        .header h1 { font-size: 32px; font-weight: 800; margin: 0; }
        
        .card { background: var(--white); padding: 25px; border-radius: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); border: 1px solid #e2e8f0; }
        
        table { width: 100%; border-collapse: separate; border-spacing: 0 12px; }
        th { text-align: left; padding: 10px 20px; color: var(--text-muted); font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 18px 20px; background: #fff; border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; vertical-align: middle; }
        td:first-child { border-left: 1px solid #f1f5f9; border-radius: 16px 0 0 16px; }
        td:last-child { border-right: 1px solid #f1f5f9; border-radius: 0 16px 16px 0; }

        .driver-cell { display: flex; align-items: center; gap: 12px; }
        .driver-cell img { width: 42px; height: 42px; border-radius: 12px; object-fit: cover; background: #f1f5f9; }
        
        .status-pill { padding: 6px 12px; border-radius: 10px; font-size: 11px; font-weight: 700; display: inline-flex; align-items: center; gap: 4px; }
        .present { background: #dcfce7; color: #15803d; }
        .absent { background: #fee2e2; color: #b91c1c; }
        .waiting { background: #f1f5f9; color: #94a3b8; }
        .online { color: #15803d; font-weight: 800; font-size: 10px; }
    </style>
</head>
<body>
<div class="sidebar">
    <a href="index.html" class="logo-container">
        <img src="school-logo.png" alt="Swarajya Gurukul" style="width: 80px; height: 80px; object-fit: contain;">
        <span class="logo-text" style="font-size: 16px; font-weight: 800; color: #b8860b;">SWARAJYA GURUKUL</span>
    </a>
    
    <nav class="nav-group">
        <a href="index.html" class="nav-item" id="nav-dash">
            <i data-lucide="layout-dashboard"></i> Dashboard
        </a>
        <a href="fleet.html" class="nav-item" id="nav-fleet">
            <i data-lucide="map"></i> Live Fleet
        </a>
        <a href="bus-health.html" class="nav-item" id="nav-health">
            <i data-lucide="heart-pulse"></i> Bus Health
        </a>
        <a href="routes.html" class="nav-item" id="nav-routes">
            <i data-lucide="route"></i> Routes
        </a>
        <a href="students.html" class="nav-item" id="nav-students">
            <i data-lucide="graduation-cap"></i> Students
        </a>
        <a href="driver-admin.html" class="nav-item" id="nav-driver">
            <i data-lucide="users"></i> Driver Monitor
        </a>
        <a href="manage-assignment.html" class="nav-item" id="nav-duty">
            <i data-lucide="user-cog"></i> Duty Assignments
        </a>
        <a href="settings.html" class="nav-item" id="nav-settings">
            <i data-lucide="settings"></i> Settings
        </a>
    </nav>

    <div class="sidebar-footer">
        <div class="nav-item logout-btn" onclick="logout()">
            <i data-lucide="log-out"></i> Logout
        </div>
    </div>
</div>

<div class="main">
    <div class="header">
        <h1>Driver Live Tracking</h1>
        <p style="color: var(--text-muted);">Real-time attendance and staff assignment status.</p>
    </div>

    <div class="card">
        <table>
            <thead>
                <tr>
                    <th>Driver Details</th>
                    <th>Bus ID</th>
                    <th>Duty Status</th>
                    <th>Cleaner Sync</th>
                    <th>Last Activity</th>
                </tr>
            </thead>
            <tbody id="liveDriverTable"></tbody>
        </table>
    </div>
</div>

<script>
    lucide.createIcons();

   // Variable name MUST be exactly 'driversList' to avoid Console Error
const driversList = [
    { id: 1, name: "Ramesh Kumar", bus: "B-01" },
    { id: 2, name: "Suresh Singh", bus: "B-02" },
    { id: 3, name: "Abdul Khan", bus: "B-03" },
    { id: 4, name: "Mahesh Patil", bus: "B-04" },
    { id: 5, name: "Vikram Dada", bus: "B-05" }
];

function updateAdminTable() {
    const tableBody = document.getElementById('liveDriverTable');
    if(!tableBody) return;
    tableBody.innerHTML = "";
    
    const now = new Date();
    const todayStr = `${now.getDate()}/${now.getMonth() + 1}/${now.getFullYear()}`;

    driversList.forEach(driver => {
        // We look for "history_5" etc.
        const rawData = localStorage.getItem("history_" + driver.id);
        const history = rawData ? JSON.parse(rawData) : [];
        
        // Find today's record
        const record = history.find(r => r.date === todayStr);

        let dStatus = record ? 
            `<span class="status-pill ${record.status.toLowerCase()}">${record.status}</span>` : 
            `<span class="status-pill waiting">Not Reported</span>`;

        tableBody.innerHTML += `
            <tr>
                <td><strong>${driver.name}</strong></td>
                <td><b style="color:#6366f1">${driver.bus}</b></td>
                <td>${dStatus}</td>
                <td>${record ? record.reason : "Pending"}</td>
            </tr>`;
    });
}
setInterval(updateAdminTable, 2000);
updateAdminTable();

    // Har 3 second mein auto-sync karega bina page refresh kiye
    setInterval(refreshTable, 3000);
    window.onload = refreshTable;
</script>
</body>
</html>
</html>